<view class="detail-prd">
  <swiper indicator-dots="true" 
      indicator-active-color="#fff" style="height:{{bannerHeight}}px"
      autoplay="true" interval="5000" duration="1000">
    <block wx:for="{{prdDetail.images}}">
      <swiper-item>
        <image src="{{item}}"/>
      </swiper-item>
    </block>
  </swiper>
  <view class="logo-info">
    <text class="name">{{prdDetail.numbers}}人拼团</text>
    <view class="info">
      <text>距结束仅剩</text>
      <view class="leftTime">
        <text class="time">{{prdDetail.leftTime_d}}</text>
        天
        <text class="time">{{wxTimerArr[0]}}</text>
        :
        <text class="time">{{wxTimerArr[1]}}</text>
        :
        <text class="time">{{wxTimerArr[2]}}</text>
      </view>
    </view>
  </view>
  <view class="panel" style="position:relative">
    <view class="buying-info">
      <view class="price-now">
        <text class="money-flag">￥</text>
        <text class="now-pref">{{prdDetail.price_pref}}</text>
        <text class="now-suff">{{prdDetail.price_suff}}</text>
        <view class="gp-info">{{prdDetail.numbers}}人拼团价</view>
      </view>
      <view class="price-org">
        <text>原价 ￥{{prdDetail.orgPrice}}</text>
      </view>
    </view>
    <view class="prd-name display-col">
      <text class="name">{{prdDetail.prdName}}</text>
      <text class="desc">{{prdDetail.prdDesc}}</text>
    </view>
    <view class="share">
      <button class="btn link" bindtap="showModalDlgPost">
        <image src="../../images/icons/fx.png"></image>
        <text>分享</text>
      </button>
    </view>
    <view class="count">
      <text>销量 {{prdDetail.salesCount}}</text>
      <text class="align-right">剩余 {{prdDetail.leftCount}}</text>
    </view>  
  </view>
</view>
<view class="detail-gp panel-no-radius" style="display:{{grps.length!=0&&canBuy?'block':'none'}}"> 
  <view class="group-list">
    <text class="title">以下小伙伴正在发起拼团，您可以直接参与</text>
    <view wx:for="{{grps}}" wx:for-item="item" class="item">
      <image class="user-head" src="{{item.avatarUrl}}"></image>
      <view class="content">
        <view><text class="user-name">{{item.nickname}}</text></view>
        <view class="group-info">
          <view class="number-info">
            <text>还差</text>
            <text class="fc-primary">{{item.leftNumbers}}</text>
            <text>人成团</text>
          </view>
          <text class="time-info">剩余{{item.validatedTime_h}}:{{item.validatedTime_m}}</text>
        </view>
      </view>        
      <button class="btn mini" bindtap="gotoGrpDetail" data-grpid="{{item.grpId}}">去凑团</button>
    </view>
    <view class="lookmore" style="display:{{haveShowAllGroups}}">
      <button class="btn link" bindtap="showAllGroups">查看更多拼团 ></button>
    </view>       
  </view>
</view>
<view class="detail-other panel-no-radius"> 
  <view class='tab'>
    <view class='tab-nav'>
      <view class='{{currentTab==0?"on":""}}' data-current="0" bindtap='tabChange'>商品详情</view>
      <view class='{{currentTab==1?"on":""}}' data-current="1" bindtap='tabChange'>成交记录</view>
      <view class='{{currentTab==2?"on":""}}' data-current="2" bindtap='tabChange'>相关问题</view>
    </view>
    <swiper class='tab-box' current="{{currentTab}}" bindchange="tabSwiper">
      <swiper-item>
        {{prdDetail.detailContent}}
      </swiper-item>
      <swiper-item>
        <view class="record-list">
          <view wx:for="{{records}}" class="record-item display-row">
            <view><text>{{item.timeAgo}}</text></view>
            <view><text>{{item.nickName}}</text></view>
            <view><text>{{item.quantity}}</text></view>
          </view>
        </view>
      </swiper-item>
      <swiper-item>
        {{prdDetail.question}}
      </swiper-item>
    </swiper>
  </view>
</view>  
<view class='fixedBottom'>
  <view class="actionBar">
    <view class='customer'>
    </view>
    <view class='groupPurse' bindtap='showModalDlgBuycount'>
      <view class="price-now" wx:if="{{canBuy}}">
        <text class="money-flag">￥</text>
        <text class="now-pref">{{prdDetail.price_pref}}</text>
        <text class="now-suff">{{prdDetail.price_suff}}</text>
      </view>
      <text class="btn-pt" wx:if="{{canBuy}}">开团价</text>
      <text class="btn-look" wx:if="{{!canBuy}}">查看我的团</text>
    </view>
  </view>
</view>
<view class="mask" wx:if="{{showModalDlgBuycountFlg || showModalDlgPostFlg}}" bindtap="hideModalDlg"></view>

<!-- 海报组件 -->
<view class="modalDlg" wx:if="{{showModalDlgPostFlg}}" style="background:#f0f0f0">
  <button class="btn large-single" open-type='share'>发送给朋友</button>
  <button class="btn large-single" bindtap="makeSharePoster">生成海报</button>
  <button class="btn large-single mt-20" bindtap="hideModalDlg">取消</button>
</view>
<my-poster id="poster"
  imageUrl="{{prdDetail.imageSingle}}"
  price="{{prdDetail.price}}"
  orgPrice="{{prdDetail.orgPrice}}"
  numbers="{{prdDetail.numbers}}"
  prdId="{{prdDetail.prdId}}"
  prdName="{{prdDetail.prdName}}"
  prdDesc="{{prdDetail.prdDesc}}">
</my-poster>

<!-- 购买数量组件 -->
<view wx:if="{{showModalDlgBuycountFlg}}">
  <my-buycount
    detail="{{prdDetail}}"
    limitCount="{{prdDetail.restCount}}"
    prdImage="{{prdDetail.imageSingle}}"
    bind:hideEvent="hideModalDlgBuycount"
    bind:nextEvent="gotoNext">
  </my-buycount>
</view>

