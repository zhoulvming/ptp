<view class="detail-prd">
  <swiper style="height:{{bannerHeight}}px">
    <block wx:for="{{prdDetail.images}}">
      <swiper-item>
        <image src="{{item}}"/>
      </swiper-item>
    </block>
  </swiper>
  <view class="logo-info">
    <text class="name">{{prdDetail.numbers}}人拼团</text>
    <view class="info">
      <text>距结束仅剩</text>
      <view class="leftTime">
        <text>{{prdDetail.leftTime_d}} 天 {{wxTimer}}</text>
      </view>
    </view>
  </view>
  <view class="panel" style="position:relative">
    <view class="buying-info">
      <view class="price-now">
        <text class="money-flag">￥</text>
        <view class="now-pref">{{prdDetail.price_pref}}</view>
        <view class="now-suff">.{{prdDetail.price_suff}}</view>
        <view class="gp-info">{{prdDetail.numbers}}人拼团价</view>
      </view>
      <view class="price-org">
        <text>原价 ￥{{prdDetail.orgPrice}}</text>
      </view>
    </view>
    <view class="prd-name display-col">
      <text class="name">{{prdDetail.prdName}}</text>
      <text class="desc">{{prdDetail.prdDesc}}</text>
    </view>
    <view class="share">
      <button class="btn link" bindtap="showModalPost">
        <image src="../../images/icons/fx.png"></image>
        <text>分享</text>
      </button>
    </view>
    <view class="count">
      <text>销量 {{prdDetail.salesCount}}</text>
      <text class="align-right">剩余 {{prdDetail.leftCount}}</text>
    </view>  
  </view>
</view>
<view class="detail-gp panel-no-radius" style="display:{{grps.length!=0?'block':'none'}}"> 
  <view class="group-list">
    <text class="title">以下小伙伴正在发起拼团，您可以直接参与</text>
    <view wx:for="{{grps}}" wx:for-item="item" class="item">
      <image class="user-head" src="{{item.avatarUrl}}"></image>
      <view class="content">
        <view><text class="user-name">{{item.nickname}}</text></view>
        <view class="group-info">
          <view class="number-info">
            <text>还差</text>
            <text class="fc-primary">{{item.leftNumbers}}</text>
            <text>人成团</text>
          </view>
          <text class="time-info">剩余{{item.validatedTime_d}}天{{item.validatedTime_h}}时{{item.validatedTime_m}}分{{item.validatedTime_s}}秒</text>
        </view>
      </view>        
      <button class="btn mini" bindtap="gotoGrpDetail" data-grpid="{{item.grpId}}">去凑团</button>
    </view>
    <view class="lookmore" style="display:{{haveShowAllGroups}}">
      <button class="btn link" bindtap="showAllGroups">查看更多拼团 ></button>
    </view>       
  </view>
</view>
<view class="detail-other panel-no-radius"> 
  <view class='tab'>
    <view class='tab-nav'>
      <view class='{{currentTab==0?"on":""}}' data-current="0" bindtap='tabChange'>商品详情</view>
      <view class='{{currentTab==1?"on":""}}' data-current="1" bindtap='tabChange'>成交记录</view>
      <view class='{{currentTab==2?"on":""}}' data-current="2" bindtap='tabChange'>相关问题</view>
    </view>
    <swiper class='tab-box' current="{{currentTab}}" bindchange="tabSwiper">
      <swiper-item>
        {{prdDetail.detailContent}}
      </swiper-item>
      <swiper-item>
        <view class="record-list">
          <view wx:for="{{records}}" class="record-item display-row">
            <view><text>{{item.leftTime}}</text></view>
            <view><text>{{item.nickName}}</text></view>
            <view><text>{{item.quantity}}</text></view>
          </view>
        </view>
      </swiper-item>
      <swiper-item>
        {{prdDetail.question}}
      </swiper-item>
    </swiper>
  </view>
</view>  
<view class='fixedBottom'>
  <view class='customer'>
    <navigator url=''>
      <image mode='widthFix' src="../../images/icons/pin.png" />
      <text>客服</text>
    </navigator>
  </view>
  <!--
  <view class='singlePurse' bindtap='showModal' data-buyway="0">
    <view class="price">
      <text class="flag">¥</text>
      <text class="orgPrice">{{prdDetail.orgPrice}}</text>
    </view>
    <text>单人价</text>
  </view>
  -->
  <view class='groupPurse' bindtap='showModal' data-buyway="1" style="display:{{haveOrder==false?'block':'none'}}">
    <view class="price">
      <text class="flag">¥</text>
      <text class="pref">{{prdDetail.price_pref}}.</text>
      <text class="suff">{{prdDetail.price_suff}}</text>
    </view>
    <text>开团价</text>
  </view>
</view>  
<view class="mask" catchtouchmove="preventTouchMove" wx:if="{{showModal || showModalPost}}" bindtap="hideModalDlg"></view>
<view class="modalDlg" wx:if="{{showModal}}" bindtap="handleTapDlg">
  <view class="prd-info">
    <view class="picture"><image src="{{prdDetail.imageSingle}}" mode="scaleToFill"/></view>
    <view class="info">
      <text class="name">{{prdDetail.prdName}} </text>
      <text class="gp-info">{{prdDetail.numbers}} 人拼团价</text>
      <text class="price" style="display:{{buyway==1?'block':'none'}}">￥{{prdDetail.price}}</text>
      <text class="price" style="display:{{buyway==0?'block':'none'}}">￥{{prdDetail.orgPrice}}</text>
    </view>
    <image class="close" src="../../images/icons/close.png" bindtap="hideModalDlg" />
  </view>
  <view class="buycount">
    <view class="info">
      <text class="largeText">购买数量</text>
      <text class="leftCount">剩余 {{prdDetail.leftCount}} 件数</text>    
    </view>
    <view class='count'>
      <view class="input">
        <view class='ic' bindtap='evic' wx:if="{{!minflag}}">-</view>
        <view class='ic off' bindtap='evic' wx:if="{{minflag}}">-</view>
        <text class='in'>{{num}}</text>
        <view class="ad" bindtap='evad' wx:if="{{!maxflag}}">+</view>
        <view class="ad off" bindtap='evad' wx:if="{{maxflag}}">+</view>
      </view>
      <view class="info">
        <text>每人限购 {{prdDetail.limitCount}} 件</text>
      </view>
    </view>
  </view>
  <button class="btn-bottom" bindtap="gotoNext" data-target="confirm-order">下一步</button>
</view>
<view class="modalDlg" wx:if="{{showModalPost}}" style="background:#f0f0f0">
  <button class="btn large-single" open-type='share'>发送给朋友</button>
  <button class="btn large-single" bindtap="makeSharePoster">生成海报</button>
  <button class="btn large-single mt-20" bindtap="hideModalDlg">取消</button>
</view>
<my-poster id="poster"
  imageUrl="{{prdDetail.imageSingle}}"
  price="{{prdDetail.price}}"
  orgPrice="{{prdDetail.orgPrice}}"
  numbers="{{prdDetail.numbers}}"
  prdId="{{prdDetail.prdId}}"
  prdName="{{prdDetail.prdName}}"
  prdDesc="{{prdDetail.prdDesc}}">
</my-poster>